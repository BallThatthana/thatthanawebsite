{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n/* eslint-disable */\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword } from 'firebase/auth';\nimport { doc, setDoc, getDoc, getDocs, collection, where } from 'firebase/firestore';\nimport { db, auth } from '../../firebase';\nimport { showSweetAlert } from '../utils/sweetalert';\nimport router from '@/routes';\nconst DEFAULT_USER = {\n  uid: null,\n  email: null,\n  firstname: null,\n  lastname: null,\n  isAdmin: null\n};\nconst authModule = {\n  state() {\n    return {\n      user: DEFAULT_USER,\n      auth: false\n    };\n  },\n  getters: {\n    getUserData: state => state.user,\n    isAuth: state => state.auth\n  },\n  mutations: {\n    setUser(state, payload) {\n      state.user = {\n        ...state.user,\n        ...payload\n      };\n      state.auth = true;\n    },\n    clearUser(state) {\n      state.user = DEFAULT_USER;\n      state.auth = false;\n    },\n    auth(state) {\n      return state.auth = true;\n    }\n  },\n  actions: {\n    async signOut({\n      commit\n    }) {\n      try {\n        await auth.signOut();\n        commit('clearUser');\n        showSweetAlert('success', 'ออกจากระบบสำเร็จ', false, 1500);\n        router.push('/');\n      } catch (error) {\n        console.log(error);\n      }\n    },\n    async autosign({\n      commit,\n      dispatch\n    }, payload) {\n      try {\n        const userData = await dispatch('auth/getUserProfile', payload.uid);\n        commit('setUser', userData);\n        return true;\n      } catch (error) {\n        console.log(error);\n      }\n    },\n    async getUserProfile({\n      commit\n    }, payload) {\n      try {\n        const docSnap = await getDoc(doc(db, 'users', payload));\n        if (docSnap.exists()) {\n          return docSnap.data();\n        } else {\n          return null;\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n    async signin({\n      commit,\n      dispatch\n    }, payload) {\n      const {\n        email,\n        password\n      } = payload;\n      try {\n        const userCredential = await signInWithEmailAndPassword(auth, email, password);\n        const userData = await dispatch('getUserProfile', userCredential.user.uid);\n        commit('setUser', userData);\n        commit('auth');\n        showSweetAlert('success', 'เข้าสู่ระบบสำเร็จ', false, 1500);\n        router.push('/');\n      } catch (error) {\n        console.log(error);\n      }\n    },\n    async signup({\n      commit\n    }, payload) {\n      try {\n        const userCredential = await createUserWithEmailAndPassword(auth, payload.email, payload.password);\n        const newUser = {\n          uid: userCredential.user.uid,\n          email: userCredential.user.email,\n          isAdmin: false /// warning -  cloud function\n        };\n\n        await setDoc(doc(db, 'users', userCredential.user.uid), newUser);\n        commit('setUser', newUser);\n        showSweetAlert('success', 'ลงทะเบียนสำเร็จ', false, 1500);\n      } catch (error) {\n        if (error.code === 'auth/email-already-in-use') {\n          showSweetAlert('error', 'อีเมลนี้ใช้เเล้ว', false, 1500);\n        } else {\n          showSweetAlert('error', error, false, 1500);\n        }\n      }\n    }\n  }\n};\nexport default authModule;","map":{"version":3,"names":["createUserWithEmailAndPassword","signInWithEmailAndPassword","doc","setDoc","getDoc","getDocs","collection","where","db","auth","showSweetAlert","router","DEFAULT_USER","uid","email","firstname","lastname","isAdmin","authModule","state","user","getters","getUserData","isAuth","mutations","setUser","payload","clearUser","actions","signOut","commit","push","error","console","log","autosign","dispatch","userData","getUserProfile","docSnap","exists","data","signin","password","userCredential","signup","newUser","code"],"sources":["C:/Users/Ball/OneDrive/Documents/Web dev/own-website/src/Store/auth/index.js"],"sourcesContent":["\r\n/* eslint-disable */\r\nimport {\r\n    createUserWithEmailAndPassword,\r\n    signInWithEmailAndPassword\r\n} from 'firebase/auth';\r\nimport { doc, setDoc, getDoc, getDocs, collection, where } from 'firebase/firestore';\r\nimport { db, auth } from '../../firebase';\r\nimport { showSweetAlert } from '../utils/sweetalert'\r\nimport router from '@/routes';\r\n\r\n\r\nconst DEFAULT_USER = {\r\n    uid:null,\r\n    email:null,\r\n    firstname:null,\r\n    lastname:null,\r\n    isAdmin:null\r\n}\r\n\r\n\r\nconst authModule = {\r\n    state(){\r\n        return {\r\n            user: DEFAULT_USER,\r\n            auth: false\r\n        }   \r\n    },\r\n    getters:{\r\n        getUserData: state => state.user,\r\n        isAuth: state => state.auth,\r\n    },\r\n    mutations:{\r\n        setUser(state,payload){\r\n            state.user = {\r\n                ...state.user,\r\n                ...payload\r\n            }\r\n            state.auth = true;\r\n        },\r\n        clearUser(state){\r\n            state.user = DEFAULT_USER;\r\n            state.auth = false;\r\n        },\r\n        auth(state) {\r\n            return state.auth = true;\r\n          }\r\n    },\r\n    actions:{\r\n        async signOut({commit}){\r\n            try{\r\n                await auth.signOut();\r\n                commit('clearUser');\r\n                showSweetAlert('success', 'ออกจากระบบสำเร็จ', false, 1500);\r\n                router.push('/')\r\n            } catch(error){\r\n                console.log(error)\r\n            }\r\n        },\r\n        async autosign({commit,dispatch},payload){\r\n            try {\r\n                const userData = await dispatch('auth/getUserProfile',payload.uid);\r\n                commit('setUser', userData);\r\n                return true;\r\n            } catch(error){\r\n                console.log(error)\r\n            }\r\n        },\r\n        async getUserProfile({commit},payload){\r\n            try{\r\n                const docSnap = await getDoc(doc(db,'users',payload));\r\n\r\n                if(docSnap.exists()){\r\n                    return docSnap.data();\r\n                } else {\r\n                    return null\r\n                }\r\n            } catch(error){\r\n                console.log(error)\r\n            }\r\n        },\r\n        async signin({commit,dispatch},payload){\r\n\r\n            const { email, password} = payload\r\n\r\n            try {\r\n                const userCredential = await signInWithEmailAndPassword(\r\n                    auth,\r\n                    email,\r\n                    password\r\n                );\r\n                \r\n                const userData = await dispatch('getUserProfile',userCredential.user.uid);\r\n                commit('setUser', userData); \r\n                commit('auth');\r\n                showSweetAlert('success', 'เข้าสู่ระบบสำเร็จ', false, 1500)\r\n                router.push('/');       \r\n            } catch(error){\r\n                console.log(error)     \r\n            }\r\n        },\r\n        async signup({commit},payload){\r\n            try{\r\n                const userCredential = await createUserWithEmailAndPassword(\r\n                    auth,\r\n                    payload.email,\r\n                    payload.password\r\n                );\r\n\r\n                const newUser = {\r\n                    uid:userCredential.user.uid,\r\n                    email:userCredential.user.email,\r\n                    isAdmin:false /// warning -  cloud function\r\n                }\r\n                    await setDoc(doc(db,'users',userCredential.user.uid),newUser);\r\n                    commit('setUser',newUser);\r\n                    showSweetAlert('success', 'ลงทะเบียนสำเร็จ', false, 1500);\r\n                } catch(error){\r\n                if (error.code === 'auth/email-already-in-use'){\r\n                    showSweetAlert('error', 'อีเมลนี้ใช้เเล้ว', false, 1500);\r\n                } else {\r\n                    showSweetAlert('error',  error , false, 1500);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default authModule;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}