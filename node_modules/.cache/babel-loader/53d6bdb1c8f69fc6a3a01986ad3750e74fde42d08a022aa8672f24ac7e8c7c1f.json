{"ast":null,"code":"/* eslint-disable */\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from 'firebase/auth';\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\nimport { db, auth } from '../../firebase';\nimport { showSweetAlert } from '../utils/sweetalert';\nimport router from '@/routes';\nconst DEFAULT_USER = {\n  uid: null,\n  email: null,\n  firstname: null,\n  lastname: null,\n  isAdmin: null\n};\nconst authModule = {\n  state() {\n    return {\n      user: DEFAULT_USER,\n      auth: false\n    };\n  },\n  getters: {\n    getUserData: state => state.user,\n    isAuth: state => state.auth\n  },\n  mutations: {\n    setUser(state, payload) {\n      state.user = {\n        ...state.user,\n        ...payload\n      };\n      state.auth = true;\n    },\n    clearUser(state) {\n      state.user = DEFAULT_USER;\n      state.auth = false;\n    }\n  },\n  actions: {\n    async signOut({\n      commit\n    }) {\n      try {\n        await signOut(auth);\n        commit('clearUser');\n        showSweetAlert('success', 'ออกจากระบบสำเร็จ', false, 1500);\n        router.push('/login');\n      } catch (error) {\n        console.log(error);\n      }\n    },\n    async autosignin({\n      commit,\n      dispatch\n    }, payload) {\n      try {\n        const userData = await dispatch('getUserProfile', payload.uid);\n        commit('setUser', userData);\n        return true;\n      } catch (error) {\n        console.log(error);\n        return false;\n      }\n    },\n    async getUserProfile({\n      commit\n    }, payload) {\n      try {\n        const docSnap = await getDoc(doc(db, 'users', payload));\n        if (docSnap.exists()) {\n          return docSnap.data();\n        } else {\n          return null;\n        }\n      } catch (error) {\n        console.log(error);\n        return null;\n      }\n    },\n    async signin({\n      commit,\n      dispatch\n    }, payload) {\n      const {\n        email,\n        password\n      } = payload;\n      try {\n        const userCredential = await signInWithEmailAndPassword(auth, email, password);\n        const userData = await dispatch('getUserProfile', userCredential.user.uid);\n        commit('setUser', userData);\n        showSweetAlert('success', 'เข้าสู่ระบบสำเร็จ', false, 1500);\n        router.push('/');\n      } catch (error) {\n        console.log('signin error:', error);\n        if (error.code === 'auth/wrong-password') {\n          showSweetAlert('error', 'ใส่รหัสผิด', false, 1500);\n        } else {\n          showSweetAlert('error', error, false, 1500);\n        }\n      }\n    },\n    async signup({\n      commit\n    }, payload) {\n      try {\n        const userCredential = await createUserWithEmailAndPassword(auth, payload.email, payload.password);\n        const newUser = {\n          uid: userCredential.user.uid,\n          email: userCredential.user.email,\n          isAdmin: false // warning -  cloud function\n        };\n\n        await setDoc(doc(db, 'users', userCredential.user.uid), newUser);\n        commit('setUser', newUser);\n        showSweetAlert('success', 'ลงทะเบียนสำเร็จ', false, 1500);\n      } catch (error) {\n        if (error.code === 'auth/email-already-in-use') {\n          showSweetAlert('error', 'อีเมลนี้ใช้เเล้ว', false, 1500);\n        } else {\n          showSweetAlert('error', error, false, 1500);\n        }\n      }\n    }\n  }\n};\nexport default authModule;","map":{"version":3,"names":["createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","doc","setDoc","getDoc","db","auth","showSweetAlert","router","DEFAULT_USER","uid","email","firstname","lastname","isAdmin","authModule","state","user","getters","getUserData","isAuth","mutations","setUser","payload","clearUser","actions","commit","push","error","console","log","autosignin","dispatch","userData","getUserProfile","docSnap","exists","data","signin","password","userCredential","code","signup","newUser"],"sources":["C:/Users/Ball/OneDrive/Documents/Web dev/own-website/src/Store/auth/index.js"],"sourcesContent":["/* eslint-disable */\r\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from 'firebase/auth';\r\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\r\nimport { db, auth } from '../../firebase';\r\nimport { showSweetAlert } from '../utils/sweetalert';\r\nimport router from '@/routes';\r\n\r\nconst DEFAULT_USER = {\r\n  uid: null,\r\n  email: null,\r\n  firstname: null,\r\n  lastname: null,\r\n  isAdmin: null\r\n};\r\n\r\nconst authModule = {\r\n  state() {\r\n    return {\r\n      user: DEFAULT_USER,\r\n      auth: false\r\n    };\r\n  },\r\n  getters: {\r\n    getUserData: state => state.user,\r\n    isAuth: state => state.auth\r\n  },\r\n  mutations: {\r\n    setUser(state, payload) {\r\n      state.user = {\r\n        ...state.user,\r\n        ...payload\r\n      };\r\n      state.auth = true;\r\n    },\r\n    clearUser(state) {\r\n      state.user = DEFAULT_USER;\r\n      state.auth = false;\r\n    }\r\n  },\r\n  actions: {\r\n    async signOut({ commit }) {\r\n      try {\r\n        await signOut(auth);\r\n        commit('clearUser');\r\n        showSweetAlert('success', 'ออกจากระบบสำเร็จ', false, 1500);\r\n        router.push('/login');\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    },\r\n    async autosignin({ commit, dispatch }, payload) {\r\n      try {\r\n        const userData = await dispatch('getUserProfile', payload.uid);\r\n        commit('setUser', userData);\r\n        return true;\r\n      } catch (error) {\r\n        console.log(error);\r\n        return false;\r\n      }\r\n    },\r\n    async getUserProfile({ commit }, payload) {\r\n      try {\r\n        const docSnap = await getDoc(doc(db, 'users', payload));\r\n\r\n        if (docSnap.exists()) {\r\n          return docSnap.data();\r\n        } else {\r\n          return null;\r\n        }\r\n      } catch (error) {\r\n        console.log(error);\r\n        return null;\r\n      }\r\n    },\r\n    async signin({ commit, dispatch }, payload) {\r\n      const { email, password } = payload;\r\n\r\n      try {\r\n        const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n        const userData = await dispatch('getUserProfile', userCredential.user.uid);\r\n        commit('setUser', userData);\r\n        showSweetAlert('success', 'เข้าสู่ระบบสำเร็จ', false, 1500);\r\n        router.push('/');\r\n      } catch (error) {\r\n        console.log('signin error:', error);\r\n        if (error.code === 'auth/wrong-password') {\r\n          showSweetAlert('error', 'ใส่รหัสผิด', false, 1500);\r\n        } else {\r\n          showSweetAlert('error', error, false, 1500);\r\n        }\r\n      }\r\n    },\r\n    async signup({ commit }, payload) {\r\n      try {\r\n        const userCredential = await createUserWithEmailAndPassword(auth, payload.email, payload.password);\r\n\r\n        const newUser = {\r\n          uid: userCredential.user.uid,\r\n          email: userCredential.user.email,\r\n          isAdmin: false // warning -  cloud function\r\n        };\r\n\r\n        await setDoc(doc(db, 'users', userCredential.user.uid), newUser);\r\n        commit('setUser', newUser);\r\n        showSweetAlert('success', 'ลงทะเบียนสำเร็จ', false, 1500);\r\n      } catch (error) {\r\n        if (error.code === 'auth/email-already-in-use') {\r\n          showSweetAlert('error', 'อีเมลนี้ใช้เเล้ว', false, 1500);\r\n        } else {\r\n          showSweetAlert('error', error, false, 1500);\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport default authModule;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}